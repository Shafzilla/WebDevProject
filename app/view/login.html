<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<body>

<div class="container py-5">
    <div class="card signup-card shadow-lg p-4">
        <h1 class="text-center mb-4">Log in</h1>

        <form id="login-form">

            <!-- Username Input -->
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" class="form-control" id="username" aria-describedby="usernameHelp">
            </div>


            <!-- Password Input -->
            <div class="mb-3">
                <label for="password" class="form-label fw-bold">Password</label>
                <input type="password" class="form-control" id="password" required minlength="6" placeholder="Must be at least 6 characters">
            </div>

            <!-- Confirmation Message Area -->
            <div id="message-area" class="alert alert-light d-none" role="alert"></div>

            <!-- Submit Button -->
            <button type="submit" style="background-color: #00b14f" class=" w-100 mt-3 fs-5" id="login-button">Login</button>
        </form>

        <div class="text-center mt-4">
            <p class="mb-0">Don't have an account? <a href="/signup" class="text-decoration-none text-primary fw-bold">Sign Up</a></p>
            <a href="/" class="btn btn-link mt-2">Back to Restaurants</a>
        </div>

    </div>
</div>

<script>

    document.getElementById("login-form").addEventListener("submit", async function(e) {

        e.preventDefault();

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const messageArea = document.getElementById("message-area");
        const loginButton = document.getElementById("login-button");

        const response = await fetch("/api/login", {

            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({username, password})
        })



        if (response.ok){
            const result = await response.json();

            messageArea.classList.remove("alert-info");
            messageArea.classList.add("alert-success");
            messageArea.textContent = `welcome back ${result.username}!`;
            messageArea.classList.remove("d-none");
            loginButton.disabled = true;
            username.disabled = true;
            password.disabled = true;
            document.getElementById("login-form").reset();
            window.location.href = '/'
        }
        else if (response.status === 401) {

            messageArea.classList.remove("alert-info");
            messageArea.classList.add("alert-success");
            messageArea.textContent = `Incorrect credentials!`;
            messageArea.classList.remove("d-none");

        }


    })


</script>


</body>
</html>